<?php  error_reporting(0);
defined('BASEPATH') OR exit('No direct Script Access Allowed..');

class Ajax extends CI_Controller{
            public function __construct() {
            parent::__construct();
            $this->load->model(array('product_model','profile_model','search_model'));
            $this->load->library(array('form_validation','session','upload','email'));
            $this->load->helper(array('url','html','form'));
            $this->load->library('calendar');
        }
       
        
        
        
        
        public function getproducts(){
           // echo '<pre>';print_r($_REQUEST); echo '</pre>';
           $pid= $_REQUEST['pid'];
           $cid= $_REQUEST['cid'];
           $ee = "select * from customers_principal_assigned where pid='$pid' and cid='$cid'";
           $customer_product=$this->db->query($ee)->result_array();
       //  echo '<pre>'; print_r($customer_product); echo '</pre>';
            $pro_assidnedhtml= "";
         
          
               
                    
                    
                    $pro_assidnedhtml.=" <h4>Products</h4> 
                 <table class='order-list table table-bordered table-hover veg_item'>
                    <thead>
                        <tr>
                            <th width='5%'></th>
                            <th width='20%'>Product Name</th>
                            <th width='20%'>Price</th>
                            <th width='15%'>Quantity</th>
                            <th width='22%'>Sub Total</th>
                        </tr>
                    </thead>
                    <tbody>";
                     if(!empty($customer_product)) {  foreach( $customer_product as $productdata) {
                         $productid=$productdata['product_id'];
                          $pname = "SELECT * FROM `principal_products` WHERE `id`= '$productid' ";
                         $product_name =$this->db->query($pname)->row_array();
                        $pro_assidnedhtml.="<tr>
                        <td style=' text-align:center;vertical-align: middle;'>
                            <input type='checkbox' name='selectedproducts[{$product_name['id']}]' value='{$product_name['id']}'>
                                 
                        </td>
                            <td>
                              <input type='hidden' name='commission[{$product_name['id']}]' id='' class='form-control changesNo'  style='width: 100%;' value='{$productdata['commission']}' readonly>
                                <input type='text' name='name[{$product_name['id']}]' id='' class='form-control changesNo'  style='width: 100%;' value='$product_name[product_name]' readonly>
                                 
                            </td>
                            <td><input type='text' name='price[{$product_name['id']}]' id='price$product_name[id]' class='form-control changesNo' onkeyup='calc()' style='width: 100%;' value='{$product_name['product_price']}' readonly></td>
                            
                           <td> <input type='text' name='cunt[{$product_name['id']}]' id='cunt$product_name[id]' class='form-control changesNo'  onkeyup='calc()' style='width: 100%;' value=''>
                         
                            </td>
                           <td> <input type='text' name='subprice[{$product_name['id']}]' id='subprice$product_name[id]' class='form-control changesNo'  style='width: 100%;'  value=''>   </td>
                        </tr>";
                      }  }else{
                          $pro_assidnedhtml.="<tr><td colspan='5'>No product Found</td></tr>";
                      }
                    $pro_assidnedhtml.="</tbody>
       
        <tfoot>
        <tr>
            <td colspan='4' style=' text-align:  right;vertical-align: middle;'>
               Total 
            </td>
            <td>
            <input type='text' name='totalprice' id='totalprice' class='form-control changesNo'  style='width: 100%;'  value=''>
            </td>
        </tr>
    </tfoot>
    </table>
    "; 
                    
                
           
               
           
          echo $pro_assidnedhtml; die();       
         
           
        }
        public function getprincipalcontact(){
            $all_response=array();
            $all_response['status']="true";
           $all= $data=array();
            if(isset($_REQUEST['pid'])) {
                $gg=$_REQUEST['pid'];
                $all[]=$gg;
                foreach($all as $pid){
                $res=array();
                $ee="select * from principal_contacts where pid='$pid'";
                $principal_contacts=$this->db->query($ee)->result_array();
                $principal_contactshtml="";
                if(!empty($principal_contacts)) {
                    $principal_contactshtml.="<h4>Principal Contacts</h4><select class='form-control' id='principal_contacts' name='principal_contacts'>";
                    foreach($principal_contacts as $contacts){
                        $principal_contactshtml.="<option value='{$contacts['id']}'>{$contacts['name']}</option>";
//                        $principal_contactshtml.="<div class='checkbox'><label><input type='hidden' class='principal_contacts_email principal_contacts_email{$contacts['id']} ' /><input type='checkbox' name='principal_contacts[]' class='principal_contacts principal_contacts{$contacts['id']}' value='{$contacts['id']}'>{$contacts['name']} </label></div>";
                        
                    }
                    $principal_contactshtml.="</select>";
                }
             
                $res['principal_contactshtml']=$principal_contactshtml;
                
                $customers_principal_assigned_html="";
                
                $ee="select * from customers_principal_assigned where pid='$pid' group by cid";
                $customers_principal_assigned=$this->db->query($ee)->result_array();
                if(!empty($customers_principal_assigned)){
                    $customers_principal_assigned_html.=" <h4>Assign Customers</h4>  <select class='form-control' onchange='showproducts()' id='customers_principal_assigned' name='customers_principal_assigned'>";
                    $customers_principal_assigned_html.="<option value=''>Please select Customer</option>";
                    foreach($customers_principal_assigned as $c_p_a){
                        $c="select * from customers where customer_id='{$c_p_a['cid']}'";
                        $customerdata=$this->db->query($c)->row_array();     
                         $customers_principal_assigned_html.="<option value='{$c_p_a['cid']}'>{$customerdata['customer_person']}</option>";
//                        $customers_principal_assigned_html.="<div class='checkbox'><label><input type='checkbox' onclick='get_products({$customerdata['customer_person']})' name='principal_contacts' class='customers_principal_assigned customers_principal_assigned{$c_p_a['cid']}' value='{$c_p_a['id']}'>{$customerdata['customer_person']} </label></div>";
                        
                    }
                     $customers_principal_assigned_html.="</select>";
                     
                }
                $res['customers_principal_assigned_html']=$customers_principal_assigned_html;
                $res['pid']=$pid;
                $data[]=$res;                
                }
                
            }
            $all_response['data']=$data;
            echo json_encode($all_response); die;
            
        }
  
}
  ?>